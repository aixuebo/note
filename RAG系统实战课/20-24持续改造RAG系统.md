# 背景与总结


# 一、21持续优化：改进应用检索质量有哪些诀窍？
其实原则很简单，就是将模糊检索，尽量转换成精准检索，而这个主要是通过两个方法去推进的。
## 1.在用户交互层面提供精确信息
比如在用户交互层面，让用户选择子分类，或者通过tab页的方式，总之给数据以明确的减少范围。
比如用户通过tab页，切换到交易模块，那此时从where中直接筛选交易模块的数据即可，使准确率提升。

## 2.在业务逻辑层面提供精确信息
比如一些关键词，一定是要准确查询，而不是模糊查询，比如用户搜索“300498 昨天有什么新闻”，300498就是指代一个股票代码，一定是精准的，而不是模糊的3004981，那就是有问题的了。
或者配件 sh-d32 还有多少？，这里的sh-d32 是一个配件型号。

我们可以维护一套关键词数据库表，有关键词+字段类型+描述。

如果关键词被命中了，那就不需要在模糊检索了。但如何与系统做交互，从用户提问中准确的提取关键词，是一个难点。
可以考虑的是用{关键词}的方式，在提问中特殊识别。这属于用户高阶用法范畴了。实际中还需要进一步调研。

# 二、22取长补短：如何借鉴LangChain、LlamIndex等RAG框架的优点
## 1.授人以鱼不如授人以渔，
通过查看 LangChain、LlamaIndex 源码，学习改进 RAG 质量的技术。

## 2.目前市面上的开源RAG框架，都可以拿来参考，找到好的实现思路
这些 RAG 框架包括 LangChain、Qanything、RAGFlow、FastGPT、LlamaIndex 等等

## 3.引入其他框架思路的步骤
* 明确问题与目标：清楚地知道自己项目所存在的问题以及自己想要什么。
比如我们发现不知道如何拆分数据，即一篇文章应该拆分成几个prompt做向量，以及拆分的理论依据是什么。
* 寻找工具或参考：分析官网文档找到可以解决这些问题的工具或者参考。
去各个开源的框架里找线索，相信一定有人也遇到过这类问题。

当时的我发现 LlamaIndex 有这么一个概念——SentenceWindowNodeParser（句子窗口节点解析器）。
当时的 LlamaIndex 官网是这么描述这个概念的：以每五句话为一个窗口进行分割。结合官网给的示例，使用句子窗口节点解析器，我们会将第 1 句话到第 5 句话分成第一段文本，第 2 句话到第 6 句话分成第二段文本，第 3 句话到第 7 句话分成第三段文本，以此类推。

* 找到对应源代码。

* 整合进自己项目。

## 4.为什么不直接用开源的方案，而是要自己整合呢
* RAG框架更新太快，而且兼容性并没有想象中的好。
因此每次版本迭代的时候，会导致自己的代码跑不通，报错了。
* RAG框架基本处于初级阶段，很多功能都不完善，特别是在支持中文方面。
* 性能原因，只想要一个功能，但引入过多依赖，会造成高并发时，内存消耗非常大。
* 对中文的支持不友好，需要改造的点很多，一旦改造后，就很难与开源系统过度依赖了。
比如SentenceWindowNodeParser中不支持中文的? 省略号等分词拆分方法，需要稍微修改改造。

# 三、他山之石：GraphRAG等13种RAG前沿技术
## 1.GraphRAG --- 一个例子可以帮助我们理解GraphRAG的优势
由于在西游记里面，菩提祖师和唐僧并没有直接的关系，而且关于他们的描述分布在不同的章节，他们并没有出现在同一个章节里面。
因此使用传统 RAG 检索方法，我们只能检索出菩提祖师的相关知识，以及唐僧的相关知识，但是并没有办法推断出他们之间的关系。

如果使用 GraphRAG 情况就不一样了，菩提祖师、唐僧、孙悟空会在入库的时候被提取成三个实体，然后将建立两段关系：
菩提祖师是孙悟空的师傅，唐僧是孙悟空的师傅。在检索知识的时候，将会检索到这三个实体和两段关系，然后喂给大模型。这样一来，大模型就能够回答：菩提祖师和唐僧都是孙悟空的师傅。

## 2.GraphRAG 最大的难点在于如何将知识正确入库
我举一个例子来帮你理解，假设有以下内容：
孙悟空在火焰山面前无法前进，喊出了土地公公，询问个究竟。
孙悟空在小雷音寺面前无法前进，喊出了土地公公，询问个究竟。

以上两句话里面的土地公公并非是同一个土地公公，如何识别出是不同的两个实体，这是一个难点。

## 3.适用场景
从刚才的讲解我们了解了，GraphRAG 适用于处理超长文档和复杂关系，难点在于知识正确入库。
因此如果知识入库很简单，知识已经人工精确入库了，是可以应用 GraphRAG 的。
在现实工作中，GraphRAG 最适合的应用场景是基于社交关系的风控系统，因为这些社交关系已经正确入库了。
